---
title: "Prevalence and correlates of hypertension control among almost 100,000 middle-aged adults receiving treatment for hypertension in the UK: Tables and Figures"
author: "Jennifer Collister"
date: "14/05/2020"
output: 
  word_document:
      reference_docx: "K:/TEU/APOE on Dementia/RMarkdownStyle.docx"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(kableExtra)
library(knitr)
library(DiagrammeR)
library(DiagrammeRsvg)
library(magrittr)
library(svglite)
library(rsvg)
library(png)
library(DescTools)
library(ggplot2)
library(forcats)
library(gridExtra)
library(scales)
library(plyr)
library(dplyr)
library(reshape2)

source("K:/TEU/APOE on Dementia/Statistical Analysis/JCfunctions.R")
options(knitr.kable.NA='')

data <- readRDS(file="K:\\TEU\\APOE on Dementia\\Data Management\\R_Dataframes_TLA\\38358\\Organised\\Hypertension\\Neo\\HTN_excl.rds")


# Comorbidities of interest
comorbs <- readRDS("K:\\TEU\\APOE on Dementia\\Data Management\\R_Dataframes_TLA\\38358\\Organised\\Hypertension\\Neo\\VI_HTNcomorb.rds")
colnames(comorbs) <- c("ID", paste0("VI_", colnames(comorbs)[-1]))
print(colnames(comorbs)[-1])
comorbs_raw <- c("VI_CVD", "VI_diabetes", "VI_afib_or_aflutter", "VI_asthma_or_COPD", "VI_migraine", "VI_epilepsy",
                 "VI_anxiety_or_stress", "VI_depression_or_bipolar", "VI_Osteoarthritis", "VI_Other_joint_disorder")
comorbs_string <- paste0(comorbs_raw, "_")

# Principal components
pclist <- paste0("GeP_PC.m",seq(1,10))

#-------------------------------------------------------------------------------------------------------------------
# Datasets:

# For the SES descriptive analyses, we want to consider two subsets: all hypertensives and all treated individuals
hypertensives <- data[data$evidenceHTN==TRUE & !is.na(data$evidenceHTN),]
treated <- data[data$treated==TRUE & !is.na(data$treated),]

# Among the treated, those who did not list any HTN meds in VI are assumed to be taking unlisted meds
treated$antiHTNmedsno <- factor(treated$antiHTNmedsno, levels=c("1", "2", ">=3", "0"),
                                labels=c("1", "2", ">=3",  "Medication list unavailable"))

# For the genetic analyses, we will consider only the genetically caucasian individuals
white <- data[data$genWhiteBrit=="White British",]
white_trt <- treated[treated$genWhiteBrit=="White British",]

pretty_names <- list(age = "Age, years",
                     agegrp = "Age group, years",
                     gender = "Gender",
                     ethnicity = "Ethnicity",
                     eth_group = "Ethnic group",
                     genWhiteBrit = "Genetically categorised as White British",
                     BMIcat = "BMI (categorical)",
                     Smo_Status = "Smoking status",
                     weekly_alcunits = "Alcohol units reported per week",
                     weekly_alccat = "Alcohol units per week (categorical)",
                     PhA_METsWkAllAct = "Weekly physical activity, MET minutes",
                     METs_over1200 = "Weekly physical activity",
                     townsend_quint = "Townsend Deprivation Index, quintiles",
                     income = "Household Income, GBP",
                     employment = "Occupation type",
                     employcat = "Occupation category",
                     ISCED = "Highest level of education (ISCED)",
                     BirthCountryIncomeLevel = "Country of birth, by income level",
                     countryResidence = "UK country of residence",
                     BowelCancerScreening = "Ever screened for bowel cancer",
                     HTNdx_durcat = "Duration of hypertension",
                     antiHTNmedsno = "Number of antihypertensive medications",
                     FamilyHist_CVD_ = "Family history of CVD",
                     comorbNumber_ = "No. of comorbidities",
                     VI_afib_or_aflutter_ = "Arrhythmia (afib/flutter)",
                     VI_anxiety_or_stress_ = "Anxiety",
                     VI_asthma_or_COPD_ = "Asthma or COPD",
                     VI_depression_or_bipolar_ = "Depression",
                     VI_diabetes_ = "Diabetes",
                     VI_epilepsy_ = "Epilepsy",
                     VI_CVD_ = "Cardiovascular disease",
                     VI_migraine_ = "Migraines",
                     VI_substance_use_ = "Substance use",
                     VI_Osteoarthritis_ = "Osteoarthritis",
                     VI_Other_joint_disorder_ = "Other joint disorder",
                     PRS = "Polygenic risk score",
                     PRS_quint = "Polygenic risk score, quintiles",
                     GeP_PC.m1 = "Principal Component 1",
                     GeP_PC.m2 = "PC 2",
                     GeP_PC.m3 = "PC 3",
                     GeP_PC.m4 = "PC 4",
                     GeP_PC.m5 = "PC 5",
                     GeP_PC.m6 = "PC 6",
                     GeP_PC.m7 = "PC 7",
                     GeP_PC.m8 = "PC 8",
                     GeP_PC.m9 = "PC 9",
                     GeP_PC.m10 = "PC 10"
                     )

figure <- 1
table <- 1
suppfig <- 1
footnote_no <- 1

```

# Figure `r figure`. Flowchart of study exclusion criteria, resulting in study population of `r nrow(treated)` treated hypertensives aged 40-70 years with complete data on core study variables and without any serious comorbidites.
`r figure <- figure + 1`
![](K:/TEU/APOE on Dementia/Statistical Analysis/NeoHypertension/RMarkdown/ExclFlowchart.png){height=700px}

# Figure `r figure`. Prevalence of hypertension, and its awareness, treatment and control among adults in the UKB.
`r figure <- figure + 1`
```{r fig2, include=TRUE, echo=FALSE, results='asis', }

dflist <- c(list("UKB"=data, "England"=data[data$countryResidence=="England",], "Scotland"=data[data$countryResidence=="Scotland",], "Wales"=data[data$countryResidence=="Wales",]))
# names(dflist) <- c("Whole population")
filenames <- list("Wholepop", "England", "Scotland", "Wales")
names(filenames) <- names(dflist)

grlist <- list()
for(dfname in names(dflist)){
  df <- dflist[[dfname]]
  nlist <- list(wholepop=nrow(df))
  pctlist <- list()
  for(variable in c("evidenceHTN", "aware", "treated", "controlled")){
    var <- paste0(variable, "_")
    tab <- table(df[[var]])
    pct <- round(100*prop.table(tab),1)
    nlist[[variable]] <- tab
    pctlist[[variable]] <- pct
  }
  export_svg(DiagrammeR::grViz("K:\\TEU\\APOE on Dementia\\Statistical Analysis\\NeoHypertension\\RMarkdown\\HTNtree.gv")) %>% charToRaw %>% rsvg %>% png::writePNG(paste0('K:/TEU/APOE on Dementia/Statistical Analysis/NeoHypertension/RMarkdown/',filenames[[dfname]],'.png'))
}

```

![Hypertension was defined as self-report of hypertensive medication use, or self-report of a prior diagnosis of hypertension, or mean BP >= 140 /90 mmHg at baseline assessment. Awareness was defined as self-report of a prior diagnosis of hypertension among those who were hypertensive. Treatment was defined as self-report of hypertensive medication among those who were aware. Control was defined as mean BP < 140/90 mmHg at baseline assessment, among those who were treated.](K:/TEU/APOE on Dementia/Statistical Analysis/NeoHypertension/RMarkdown/Wholepop.png){height=680px}

# Table `r table`: Prevalence of hypertension control among treated hypertensives (n = `r nrow(treated)`), by socioeconomic characteristics and comorbidity type
`r table <- table + 1`
```{r table1, include=TRUE, echo=FALSE}

desctable2 <- function(df){
  n <- nrow(df)
  median_age <- pretty_dp(median(df$age),1)
  median_SBP <- pretty_dp(median(df$SBP),1)
  median_DBP <- pretty_dp(median(df$DBP),1)
  control <- prop.test(x=nrow(df[df$controlled==TRUE & !is.na(df$controlled),]),
                           n=nrow(df), alternative="two.sided", conf.level=0.95)
  pct_control <- pretty_dp(control$estimate, dp=1, pct=TRUE)
  ci_control <- pretty_confint(control$conf.int[1], control$conf.int[2], dp=1, pct=TRUE)
  
  table <- cbind(n, median_age, paste0(median_SBP,"/",median_DBP), pct_control, ci_control)
  return(table)
}

treated$wholepop <- factor(1, levels=c(1), labels=c("All treated hypertensives"))
varlist=c("wholepop", "agegrp", "gender", "eth_group",
          "townsend_quint", "income", "employcat", "ISCED", "BirthCountryIncomeLevel", "countryResidence",
          "BMIcat", "Smo_Status", "weekly_alccat", "METs_over1200",
          "HTNdx_durcat", "antiHTNmedsno",  "FamilyHist_CVD_", 
          "BowelCancerScreening",
          "comorbNumber_")

tab1 <- c()
for(var in varlist){
  for(level in levels(treated[[var]])){
    newrow <- desctable2(treated[treated[var]==level,])
    tab1 <- rbind(tab1, cbind(level, newrow))
  }
}
for(comorb in comorbs_string){
  newrow <- desctable2(treated[treated[comorb]=="Yes",])
  tab1 <- rbind(tab1, cbind(prettyfunc(comorb, pnames=pretty_names), newrow))
}

footnote_no <- 1
colnames(tab1) <- c("", "n", "Median age, years", "Median SBP/DBP, mmHg", 
                    paste0("% Controlled", "^", footnote_no, "^"), "95% CI Controlled")
footnote_no <- footnote_no + 1
footnote_list <- c("townsend_quint", "employcat", "ISCED", "BirthCountryIncomeLevel", "countryResidence", "BMIcat", "METs_over1200", "comorbNumber_")

rownamer <- function(x){
  prettyname <- prettyfunc(x, pnames=pretty_names, flist=footnote_list)
  
  # Return the prettified name and the correct number of blanks
  c(prettyname, rep("", (nlevels(treated[[x]])-1)))
}
rownames(tab1) <- c(unlist(sapply(varlist, rownamer)),
                    "Comorbidities", rep("", length(comorbs_string)-1))

# Output the resulting table
add_footnote(kable(tab1), label=c("Control defined as mean SBP >= 140 mmHg or mean DBP >= 90 mmHg at baseline assessment, among participants who self-reported treatment for hypertension.",
                                  "The Townsend index is a measure of material deprivation calculated at the level of census outputs areas. Higher scores imply a greater degree of deprivation.", 
                                  "Occupation categories have been condensed from those recorded in UKB. Professional and Administrative: Managers and Senior Officials, Professional Occupations, Associate Professional and Technical Occupations, Administrative and Secretarial Occupations. Skilled trades: Skilled Trades Occupations. Services: Personal Service Occupations, Sales and Customer Service Occupations. Manual and Industrial: Process, Plant and Machine Operatives, Elementary Occupations. Other: free text entry that was not coded by UKB.", 
                                  "Participants reported all achieved qualifications; we mapped these to the International Standard Classification of Education (ISCED) categories",
                                  "Participants' self-reported country of birth was mapped to World Bank Analytical Classifications using fiscal year 2020."
                                  "The assessment centre the participant attended was used as a proxy for country of residence",
                                  "BMI has been categorised according to the NHS guidance. Underweight: Below 18.5 kg/m^2^. Normal: 18.5 - 24.9 kg/m^2^. Overweight: 25.0 - 29.9 kg/m^2^. Obese: 30.0 kg/m^2^ or above.", 
                                  "The total Metabolic Equivalent Task (MET) minutes per week is available from UKB as a derived variable based on self-reported frequency and duration of walking, moderate and vigorous activity. We have dichotomized based on the upper end of the WHO guideline range for weekly physical activity.",
                                  paste0("The number of comorbidities considered to be of interest - ", paste(sapply(comorbs_string, prettyfunc,  pnames=pretty_names, lower=TRUE), collapse=", "), ".")
                                  ), notation="number")

```

# Table `r table`. Characteristics of treated hypertensives, by blood pressure control status (n = `r nrow(treated)`).
`r table <- table + 1`
```{r table2, include=TRUE, echo=FALSE}
varlist=c("age", "agegrp", "gender", "eth_group",
          "townsend_quint", "income", "employcat", "ISCED", "BirthCountryIncomeLevel", "countryResidence",
          "BMIcat", "Smo_Status", "weekly_alcunits", "weekly_alccat", "PhA_METsWkAllAct", "METs_over1200",
          "HTNdx_durcat", "antiHTNmedsno",  "FamilyHist_CVD_", 
          "BowelCancerScreening",
          "comorbNumber_", comorbs_string)

footnote_list <- c("townsend_quint", "employcat", "ISCED", "countryResidence", "BMIcat", "METs_over1200", "comorbNumber_")
footnote_no <- 1

tab_c <- descriptivetable(df=treated[treated$controlled==TRUE,], 
                         varlist=varlist,
                         contavg='median',
                         pretty_names=pretty_names,
                         footnote_list=footnote_list)

tab_u <- descriptivetable(df=treated[treated$controlled==FALSE,], 
                         varlist=varlist,
                         contavg='median',
                         pretty_names=pretty_names,
                         footnote_list=footnote_list)

tab_o <- descriptivetable(df=treated, 
                         varlist=varlist,
                         contavg='median',
                         pretty_names=pretty_names,
                         footnote_list=footnote_list)

# uni <- regressiontable(df=treated, outcome="controlled", varlist=varlist, 
#                        regresstype="univariable")

tab2 <- cbind(tab_c, tab_u[,3:4], tab_o[,3:4]) #, as.matrix(uni)[,4:5])
tab2 <- rbind(colnames(tab2), tab2)
colnames(tab2) <- c("", "", 
    paste0("Controlled, n=", nrow(treated[treated$controlled==TRUE,])), "", 
    paste0("Uncontrolled, n=", nrow(treated[treated$controlled==FALSE,])), "",
    paste0("Overall, n=", nrow(treated)), "" #, "", ""
    )

# Output the resulting table
add_footnote(kable(tab2), label=c("The Townsend index is a measure of material deprivation calculated at the level of census outputs areas. Higher scores imply a greater degree of deprivation.", 
                                  "Occupation categories have been condensed from those recorded in UKB. Professional and Administrative: Managers and Senior Officials, Professional Occupations, Associate Professional and Technical Occupations, Administrative and Secretarial Occupations. Skilled trades: Skilled Trades Occupations. Services: Personal Service Occupations, Sales and Customer Service Occupations. Manual and Industrial: Process, Plant and Machine Operatives, Elementary Occupations. Other: free text entry that was not coded by UKB.", 
                                  "Participants reported all achieved qualifications; we mapped these to the International Standard Classification of Education (ISCED) categories",
                                  "Participants' self-reported country of birth was mapped to World Bank Analytical Classifications using fiscal year 2020."
                                  "The assessment centre the participant attended was used as a proxy for country of residence",
                                  "BMI has been categorised according to the NHS guidance. Underweight: Below 18.5 kg/m^2^. Normal: 18.5 - 24.9 kg/m^2^. Overweight: 25.0 - 29.9 kg/m^2^. Obese: 30.0 kg/m^2^ or above.", 
                                  "The total Metabolic Equivalent Task (MET) minutes per week is available from UKB as a derived variable based on self-reported frequency and duration of walking, moderate and vigorous activity. We have dichotomized based on the upper end of the WHO guideline range for weekly physical activity.",
                                  paste0("The number of comorbidities considered to be of interest - ", paste(sapply(comorbs_string, prettyfunc,  pnames=pretty_names, lower=TRUE), collapse=", "), ".")
                                  ), notation="number")

```

# Table `r table`: Multivariable logistic regression identifying factors associated with hypertension control (BP < 140/90 mmHg), among UK adults on antihypertensive treatment (n=`r nrow(treated)`)
`r table <- table + 1`
<div custom-style="Todo">Reminder: Manually re-order BMI categories</div>

```{r table3, include=TRUE, echo=FALSE}

varlist=c("agegrp", "gender", "eth_group",
          "townsend_quint", "income", "employcat", "ISCED", "BirthCountryIncomeLevel", "countryResidence",
          "BMIcat", "Smo_Status", "weekly_alccat", "METs_over1200",
          "antiHTNmedsno",  "FamilyHist_CVD_",
          "BowelCancerScreening",
          "comorbNumber_")

footnote_list <- c("townsend_quint", "employcat", "ISCED", "countryResidence", "BMIcat", "METs_over1200", "comorbNumber_")
footnote_no <- 2

n <- data.frame(descriptivetable(df=treated, 
                         varlist=varlist,
                         contavg='median',
                         pretty_names=pretty_names,
                         footnote_list=footnote_list),
                stringsAsFactors = FALSE)

adj <- regressiontable(df=treated, outcome="controlled", varlist=varlist, 
                       regresstype="adjusted", adjvarlist=c("agegrp", "gender"))
multi <- regressiontable(df=treated, outcome="controlled", varlist=varlist, 
                         regresstype="multivariable")

tab3 <- merge(adj, multi, by=c("IDcol", "Coefficient", "Level"), sort=FALSE)
# Add n column
tab3 <- cbind(n[,1:3], tab3[,4:9])

# Hide "unanswered"/"unknown"/"do not know" categories
tab3 <- tab3[-which(tab3$Level %in% c("Unknown", "Unanswered", "Do not know", "Prefer not to answer")),]
rownames(tab3) <- NULL

tab3 <- rbind(c("Coefficient", "Level", "n^1^", "OR", "95% CI", "p", "OR", "95% CI", "p"),
              as.matrix(tab3))
colnames(tab3) <- c("","","", 
                    "Age- and sex-adjusted", "", "", 
                    "Multivariable- adjusted", "", "")

# Output the resulting table
add_footnote(kable(tab3), label=c("Number of individuals in levels of a categorical variable may not add up to total n because 'Do not know' and 'Prefer not to answer' categories have been removed from results table",
                                  "The Townsend index is a measure of material deprivation calculated at the level of census outputs areas. Higher scores imply a greater degree of deprivation.", 
                                  "Occupation categories have been condensed from those recorded in UKB. Professional and Administrative: Managers and Senior Officials, Professional Occupations, Associate Professional and Technical Occupations, Administrative and Secretarial Occupations. Skilled trades: Skilled Trades Occupations. Services: Personal Service Occupations, Sales and Customer Service Occupations. Manual and Industrial: Process, Plant and Machine Operatives, Elementary Occupations. Other: free text entry that was not coded by UKB.", 
                                  "Participants reported all achieved qualifications; we mapped these to the International Standard Classification of Education (ISCED) categories",
                                  "Participants' self-reported country of birth was mapped to World Bank Analytical Classifications using fiscal year 2020."
                                  "The assessment centre the participant attended was used as a proxy for country of residence",
                                  "BMI has been categorised according to the NHS guidance. Underweight: Below 18.5 kg/m^2^. Normal: 18.5 - 24.9 kg/m^2^. Overweight: 25.0 - 29.9 kg/m^2^. Obese: 30.0 kg/m^2^ or above.", 
                                  "The total Metabolic Equivalent Task (MET) minutes per week is available from UKB as a derived variable based on self-reported frequency and duration of walking, moderate and vigorous activity. We have dichotomized based on the upper end of the WHO guideline range for weekly physical activity.",
                                  paste0("The number of comorbidities considered to be of interest - ", paste(sapply(comorbs_string, prettyfunc,  pnames=pretty_names, lower=TRUE), collapse=", "), ".")
                                  ), notation="number")

```

# Table `r table`: Multivariable logistic regression examining association of individual comorbidities with hypertension control (BP < 140/90 mmHg), among UK adults on anti-hypertensive treatment (n = `r nrow(treated)`).
`r table <- table +1`
```{r table4, include=TRUE, echo=FALSE}

varlist=c("agegrp", "gender", "eth_group",
          "townsend_quint", "income", "employcat", "ISCED", "BirthCountryIncomeLevel", "countryResidence",
          "BMIcat", "Smo_Status", "weekly_alccat", "METs_over1200",
          "antiHTNmedsno",  "FamilyHist_CVD_",
          comorbs_string,
          "BowelCancerScreening")

n <- data.frame(descriptivetable(df=treated, 
                         varlist=varlist,
                         contavg='median',
                         pretty_names=pretty_names),
                stringsAsFactors = FALSE)

adj <- regressiontable(df=treated, outcome="controlled", varlist=varlist, 
                       regresstype="adjusted", adjvarlist=c("agegrp", "gender"))
multi <- regressiontable(df=treated, outcome="controlled", varlist=varlist, 
                         regresstype="multivariable")

tab4 <- merge(adj, multi, by=c("IDcol", "Coefficient", "Level"), sort=FALSE)
# Add n to the table
tab4$n <- n$n

# Keep only the individual comorbidity rows
tab4 <- tab4[tab4$IDcol %in% c(paste0(comorbs_string, "Yes"), paste0(comorbs_string,"No")),]
rownames(tab4) <- NULL

tab4 <- tab4[,c("Coefficient", "Level", "n", "OR.x", "95% CI.x", "p.x", "OR.y", "95% CI.y", "p.y")]
tab4 <- rbind(c("Coefficient", "Level", "n", "OR", "95% CI", "p", "OR", "95% CI", "p"),
              tab4)
colnames(tab4) <- c("","","", 
                    "Age- and sex-adjusted", "", "", 
                    "Multivariable- adjusted^1^", "", "")

tab4[,1] <- sapply(tab4[,1], prettyfunc, pnames=pretty_names)

add_footnote(kable(tab4), label=c(paste0("The multivariable-adjusted model contains the following variables: ", paste(sapply(varlist, prettyfunc, pnames=pretty_names), collapse=", "), ". Note that these are all the covariates from Table 3 except for number of comorbidities.")), notation="number")

```

# Supplementary Figure `r suppfig`. Scatterplot of blood pressure among treated participants (n = `r nrow(treated)`), categorised according to hypertension threshold SBP >= 140 and/or DBP >= 90.
`r suppfig <- suppfig + 1`

```{r suppfig, include=TRUE, echo=FALSE}

# Create a factor variable for the BP categories we want to colourcode
treated$plot_color <- dplyr::case_when(
  treated$SBP >= 140 & treated$DBP < 90 ~ "High SBP",
  treated$SBP < 140 & treated$DBP >= 90 ~ "High DBP",
  treated$SBP >= 140 & treated$DBP >= 90 ~ "Both high",
  treated$SBP < 140 & treated$DBP < 90 ~ "BP controlled"
)
treated$plot_color <- factor(treated$plot_color, levels=c("BP controlled", "High DBP", "High SBP", "Both high"))

# Scatterplot showing distribution of SBP and DBP values among participants
scatter <- ggplot(data = treated, aes(DBP, SBP, color = plot_color)) +
  geom_point(size=1) +
  labs(x="DBP, mmHg", y="SBP, mmHg", 
       title="Scatterplot of blood pressure among treated participants",
       color="Measured BP category") +
  geom_vline(xintercept = 90, linetype="dotted") +
  geom_hline(yintercept = 140, linetype="dotted") +
  geom_vline(xintercept = 110, linetype="dotted") +
  geom_hline(yintercept = 180, linetype="dotted") +
  scale_color_manual(values = c("BP controlled" = "green",
                               "High DBP" = "yellow", 
                                "High SBP" = "orange",
                                "Both high" = "red"))

ggsave(filename="K:/TEU/APOE on Dementia/Statistical Analysis/NeoHypertension/RMarkdown/ScatterHTN.png",
       plot=scatter, width=7, height=4, unit="in")

```

![](K:/TEU/APOE on Dementia/Statistical Analysis/NeoHypertension/RMarkdown/ScatterHTN.png){height=300px}

# Supplementary Figure `r suppfig`. Prevalence of hypertension categories by gender and age among UKB participants with complete BP data and no serious comorbidities (n = `r nrow(data)`).
`r suppfig <- suppfig + 1`

```{r suppfig2, fig.height=3, fig.width=7}
# https://learnr.wordpress.com/2009/09/24/ggplot2-back-to-back-bar-charts/
# https://www.r-graph-gallery.com/48-grouped-barplot-with-ggplot2.html

figdata <- data[,c("ID", "age", "gender", "evidenceHTN", "aware", "treated", "controlled")]

figdata$label <- ifelse(figdata$evidenceHTN==TRUE,
                        ifelse(figdata$aware==TRUE,
                               ifelse(figdata$treated==TRUE,
                                      ifelse(figdata$controlled==TRUE, 
                                             "Controlled hypertensive", 
                                             "Inadequately treated hypertensive"),
                                      "Untreated hypertensive"),
                               "Unaware hypertensive"),
                        "No evidence of hypertension")
figdata$label <- factor(figdata$label, levels=c("Controlled hypertensive", "Inadequately treated hypertensive",
                                                "Untreated hypertensive", "Unaware hypertensive",
                                                "No evidence of hypertension"))
figdata$age_yr <- cut(figdata$age, seq(40, 70, 1), right=FALSE, labels=seq(from=40,to=69,by=1))
figdata <- figdata[,c("age_yr", "gender", "label")]

byAge <- melt(figdata, id.vars=c("label", "age_yr"))
byAge$variable <- 1

prevpct <- ggplot(byAge, aes(age_yr)) + 
  geom_bar(data=subset(byAge, value == "Female"), 
           aes(y = variable, fill = label), stat = "identity", position="fill") +
  geom_bar(data=subset(byAge, value == "Male"),
         aes(y = -variable, fill = label), stat = "identity", position="fill") +
  labs(x="Age, years", fill="Hypertension category") + 
  ggtitle("Prevalence of hypertension categories by gender and age") +
  scale_y_continuous(name="Female     -       Male",
                     labels=c("100%", "50%", "0%","50%","100%")) +
  scale_x_discrete(breaks=seq(40,70,2)) +
  geom_hline(yintercept = 0, linetype="dotted") +
  theme(axis.ticks.y = element_blank(),
          legend.title = element_text(size=8),
          legend.text = element_text(size=7)) +
  scale_fill_manual(values = c("No evidence of hypertension" = "green",
                               "Unaware hypertensive" = "yellow", 
                                "Untreated hypertensive" = "orange",
                                "Inadequately treated hypertensive" = "red",
                               "Controlled hypertensive" = "forestgreen")) +
  coord_flip()

ggsave(filename="K:/TEU/APOE on Dementia/Statistical Analysis/NeoHypertension/RMarkdown/PrevPct.png",
       plot=prevpct, width=7, height=4, unit="in")
```

![Hypertension is defined as self-report of a prior diagnosis of hypertension in touchscreen questionnaire (TQ) or verbal interview (VI), or self-report of hypertensive medication in TQ or in VI by our rubric, or mean SBP >= 140 mmHg or mean DBP >= 90 mmHg at baseline assessment. Among those with hypertension, participants are considered to be unaware hypertensives if they did not self-report a prior diagnosis of hypertension in TQ or VI, or self-report hypertensive medication in TQ or in VI by our rubric; otherwise aware. Among those who are aware of their hypertension, participants are considered to be untreated hypertensives if they did not report hypertensive medication in TQ or in VI by our rubric; otherwise treated. Among those who self-reported treatment for their hypertension, they are considered to be inadequately treated if mean SBP >= 140 mmHg or mean DBP >= 90 mmHg at baseline assessment; otherwise controlled. ](K:/TEU/APOE on Dementia/Statistical Analysis/NeoHypertension/RMarkdown/PrevPct.png){height=300px}