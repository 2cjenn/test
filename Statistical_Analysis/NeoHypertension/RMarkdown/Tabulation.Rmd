---
title: "Tabulation"
author: "Jennifer Collister"
date: "09/12/2019"
output: html_document
---

```{r setup, include=FALSE}
#--------------------------------------------------------------------------------------------------------------
# Jennifer Collister 09/12/2019
# Tabulate the variables of interest, get a sense for the numbers we're dealing with in each category
#--------------------------------------------------------------------------------------------------------------

library(RSQLite)
library(epitools)
library(reshape2)
library(dplyr)
library(survival)
library(survminer)
library(car)
library(methods)
library(knitr)
library(kableExtra)
library(pander)
library(Publish)

rm(list=(ls()[ls()!="bd"]))

source("K:/TEU/APOE on Dementia/Statistical Analysis/JCfunctions.R")

conn <- dbConnect(RSQLite::SQLite(), "K:/TEU/APOE on Dementia/Data Management/UKB.db")

filepath <- "K:\\TEU\\APOE on Dementia\\Data Management\\R_Dataframes_TLA\\38358\\"

# Investigate the list of tables
dbListTables(conn)
# and the columns of data in a table
dbGetQuery(conn, "PRAGMA table_info(BaC)")


# Age
baseline <- dbGetQuery(conn, "SELECT ID, `BAC_SEX`, `BAC_DEPRIVIND`, `BAC_BIRTHYEAR`, `BAC_BIRTHMONTH`, `BAC_DATELOSTFU`, `REC_DATEASSESS` 
                      FROM BaC JOIN REC_BASE USING (ID)")
baseline$recdate <- as.Date(baseline$Rec_DateAssess, origin=as.Date("1970-01-01"))
baseline$lfudate <- as.Date(baseline$BaC_DateLostFU, origin=as.Date("1970-01-01"))
baseline$dob <- as.Date(paste0("15",baseline$BaC_BirthMonth, baseline$BaC_BirthYear), "%d%B%Y")
baseline$age <- round(difftime(baseline$recdate, baseline$dob, unit="days")/365.25,2)


```

# Frequency tables for straight-forward variables

General decision to be made - does NA (not answering the question) equate to selecting the option "Prefer not to answer"?

Suspect this will vary depending on the question? 
Some questions may only be asked if particular answers were given to other questions, for example a non-smoker may not be asked how many cigarettes they have per day, or someone who's retired may not be asked how they commute to work. In these cases, we would want to distinguish between a participant having NA recorded because they were not asked the question, and between a participant stating that they would prefer not to answer - but what about participants who are asked the question and do not answer?

## Socio-demographics


```{r age, include=TRUE, echo=FALSE, results='asis'}
mround <- function(x, base){
  base*round(x/base)
}

kable(table(mround(baseline$age,5), useNA=c('ifany')), caption="Age, to the nearest 5 years")

kable(table(baseline$BaC_Sex, useNA=c('ifany')), caption="Gender")

kable(table(mround(baseline$BaC_DeprivInd,1), useNA=c('ifany')), caption="Townsend deprivation index, to the nearest integer")
hist(baseline$BaC_DeprivInd, main="Townsend Deprivation Index", xlab="Townsden deprivation index at baseline assessment")
```

I believe the Townsend Deprivation index is done by postcode area, but we also have Index of Multiple Deprivation data available separately for England, Scotland and Wales, so we'll need to further consider what metric we want to use for deprivation. 

### Ethnicity

```{r ethnicity, include=TRUE, echo=FALSE}
ethnicity <- readRDS(paste0(filepath, "Eth_base", ".rds"))
  #dbGetQuery(conn, "SELECT * FROM Eth_base")
ethnicity$Eth_Ethnicity <- factor(ethnicity$Eth_Ethnicity, levels=c("White", "British", "Irish", "Any other white background",
                                                                    "Mixed", "White and Black Caribbean", "White and Black African", 
                                                                    "White and Asian", "Any other mixed background",
                                                                    "Asian or Asian British", "Indian", "Pakistani", "Bangladeshi", 
                                                                    "Any other Asian background",
                                                                    "Black or Black British", "Caribbean", "African", "Any other Black background",
                                                                    "Chinese", "Other ethnic group", "Do not know", "Prefer not to answer"))
# unique(ethnicity$Eth_Ethnicity)

ethnicity$group <- ethnicity$Eth_Ethnicity
ethnicity$group[ethnicity$Eth_Ethnicity %in% c("White", "British", "Irish", "Any other white background")] <- "White"
ethnicity$group[ethnicity$Eth_Ethnicity %in% c("Mixed", "White and Black Caribbean", "White and Black African", "White and Asian", "Any other mixed background")] <- "Mixed"
ethnicity$group[ethnicity$Eth_Ethnicity %in% c("Asian or Asian British", "Indian", "Pakistani", "Bangladeshi", "Any other Asian background")] <- "Asian or Asian British"
ethnicity$group[ethnicity$Eth_Ethnicity %in% c("Black or Black British", "Caribbean", "African", "Any other Black background")] <- "Black or Black British"
ethnicity$group[is.na(ethnicity$Eth_Ethnicity)] <- "Prefer not to answer"
ethnicity$group <- factor(ethnicity$group)
# unique(ethnicity$group)

ethnicity$eth <- ethnicity$Eth_Ethnicity
ethnicity$eth[ethnicity$eth == "White"] <- "Any other white background"
ethnicity$eth[ethnicity$eth == "Mixed"] <- "Any other mixed background"
ethnicity$eth[ethnicity$eth == "Asian or Asian British"] <- "Any other Asian background"
ethnicity$eth[ethnicity$eth == "Black or Black British"] <- "Any other Black background"
ethnicity$eth[is.na(ethnicity$eth)] <- "Prefer not to answer"
ethnicity$eth <- factor(ethnicity$eth)


kable(table(ethnicity$group, useNA=c('ifany')), caption="Ethnic groups")
# kable(table(ethnicity$eth), caption="Specific ethnic groups")

```

### Education

```{r education, include=TRUE, echo=FALSE}
education <- readRDS(paste0(filepath, "Edu_base", ".rds"))

education$age <- ""
education$age[education$Edu_Age.0==-3  | is.na(education$Edu_Age.0)] <- "Prefer not to answer"
education$age[education$Edu_Age.0==-2] <- "Never went to school"
education$age[education$Edu_Age.0==-1] <- "Do not know"
education$age[education$Edu_Age.0>=0 & education$Edu_Age.0<6] <- "Younger than 6"
education$age[education$Edu_Age.0>=6 & education$Edu_Age.0<11] <- "Between 6 and 11 (~ primary school)"
education$age[education$Edu_Age.0>=11 & education$Edu_Age.0<16] <- "Between 11 and 16 (~ secondary school)"
education$age[education$Edu_Age.0>=16 & education$Edu_Age.0<18] <- "Between 16 and 18 (~ sixth-form)"
education$age[education$Edu_Age.0>=18 & education$Edu_Age.0<21] <- "Between 18 and 21 (~ university)"
education$age[education$Edu_Age.0>=21 & education$Edu_Age.0<25] <- "Between 21 and 25"
education$age[education$Edu_Age.0>=25 & education$Edu_Age.0<30] <- "Between 25 and 30"
education$age[education$Edu_Age.0>=30] <- "Older than 30"
education$age <- factor(education$age, levels=c("Younger than 6", "Between 6 and 11 (~ primary school)", "Between 11 and 16 (~ secondary school)", 
                                                "Between 16 and 18 (~ sixth-form)", "Between 18 and 21 (~ university)", 
                                                "Between 21 and 25", "Between 25 and 30", "Older than 30",
                                                "Prefer not to answer", "Never went to school", "Do not know"))


kable(table(education$age, useNA=c('ifany')), caption="Age completed full time education")
hist(education$Edu_Age.0, main="Age completed full time education", xlab="Age, years")

qualifications <- education[,c("ID", "Edu_Qualif.0", "Edu_Qualif.1", "Edu_Qualif.2", "Edu_Qualif.3", "Edu_Qualif.4", "Edu_Qualif.5")]
qualifications <- reshape(qualifications, varying=sort(colnames(qualifications[,-1])), direction="long", idvar="ID", sep=".")
qualifications <- qualifications[,!(names(qualifications) == "time")][!is.na(qualifications$Edu_Qualif),]

kable(table(qualifications$Edu_Qualif, useNA=c('ifany')), caption="Qualifications (all not highest), each participant could select multiple")
```

### Employment

```{r employment, include=TRUE, echo=FALSE}
employment <- readRDS(paste0(filepath, "Emp_base", ".rds"))

employstat <- employment[,c("ID", "Emp_CurrStatUnc.0", "Emp_CurrStatUnc.1", "Emp_CurrStatUnc.2", "Emp_CurrStatUnc.3", "Emp_CurrStatUnc.4", "Emp_CurrStatUnc.5", "Emp_CurrStatUnc.6")]
employstat <- reshape(employstat, varying=sort(colnames(employstat[,-1])), direction="long", idvar="ID", sep=".")
employstat <- employstat[,!(names(employstat) == "time")][!is.na(employstat$Emp_CurrStatUnc),]

kable(table(employstat$Emp_CurrStatUnc), caption="Employment status - see notes re corrections")


employment$distance <- ""
employment$distance[employment$Emp_Distance.0==-10] <- "Less than 1 mile"
employment$distance[employment$Emp_Distance.0==-3 | is.na(employment$Emp_Distance.0)] <- "Prefer not to answer"
employment$distance[employment$Emp_Distance.0==-1] <- "Do not know"
employment$distance[employment$Emp_Distance.0==0] <- "Always work from home (0 miles)"
employment$distance[employment$Emp_Distance.0>=1 & employment$Emp_Distance.0<6] <- "1 to 5 miles"
employment$distance[employment$Emp_Distance.0>5 & employment$Emp_Distance.0<=10] <- "6 to 10 miles"
employment$distance[employment$Emp_Distance.0>10 & employment$Emp_Distance.0<=25] <- "11 to 25 miles"
employment$distance[employment$Emp_Distance.0>25 & employment$Emp_Distance.0<=50] <- "26 to 50 miles"
employment$distance[employment$Emp_Distance.0>50 & employment$Emp_Distance.0<=100] <- "51 to 100 miles"
employment$distance[employment$Emp_Distance.0>100 & employment$Emp_Distance.0<=250] <- "101 to 250 miles"
employment$distance[employment$Emp_Distance.0>250 & employment$Emp_Distance.0<=500] <- "251 to 500 miles"
employment$distance[employment$Emp_Distance.0>500 & employment$Emp_Distance.0<=1000] <- "501 to 1000 miles"
employment$distance[employment$Emp_Distance.0>1000] <- "More than 1000 miles"
employment$distance <- factor(employment$distance, levels=c("Always work from home (0 miles)", "Less than 1 mile", "1 to 5 miles", "6 to 10 miles",
                                                            "11 to 25 miles", "26 to 50 miles", "51 to 100 miles", "101 to 250 miles", "251 to 500 miles",
                                                            "500 to 1000 miles", "More than 1000 miles", "Prefer not to answer", "Do not know"))
kable(table(employment$distance, useNA=c('ifany')), caption="Distance between home and workplace, miles")

commute <- employment[,c("ID", "Emp_CommType.0", "Emp_CommType.1", "Emp_CommType.2", "Emp_CommType.3")]
commute <- reshape(commute, varying=sort(colnames(commute[,-1])), direction="long", idvar="ID", sep=".")
commute <- commute[,!(names(commute) == "time")][!is.na(commute$Emp_CommType),]
kable(table(commute$Emp_CommType, useNA=c('ifany')), caption="Transport type for commute")

kable(table(employment$Emp_ManualWrk.0, useNA=c('ifany')), caption="Job involves heavy manual or physical work")


coding2 <- read.table("K:\\TEU\\CancerPRS\\Data_Dictionary\\Mappings\\coding2.tsv", sep="\t", header=TRUE, quote="", comment.char="$", fill=FALSE)

#-----------------------------------------------------------------------------------------------------------------------
# Combine the different tiers of job code
#-----------------------------------------------------------------------------------------------------------------------
jobcode <- merge(x=employment[,c("ID", "Emp_JobCode.0")][!is.na(employment$Emp_JobCode.0),], 
                 y=coding2[,c("coding", "parent_id", "meaning")], 
                 by.x="Emp_JobCode.0", by.y="coding", all.x=TRUE)
colnames(jobcode)[which(names(jobcode) == "meaning")] <- "Job_title"
jobcode$Job_title <- factor(jobcode$Job_title)
colnames(jobcode)[which(names(jobcode) == "Emp_JobCode.0")] <- "Job_code"
colnames(jobcode)[which(names(jobcode) == "parent_id")] <- "Subgroup_code"

jobcode <- merge(x=jobcode[,c("ID", "Job_title", "Job_code", "Subgroup_code")], 
                 y=coding2[,c("coding", "parent_id", "meaning")], 
                 by.x="Subgroup_code", by.y="coding", all.x=TRUE)
colnames(jobcode)[which(names(jobcode) == "meaning")] <- "Job_subgroup"
jobcode$Job_subgroup <- factor(jobcode$Job_subgroup)
colnames(jobcode)[which(names(jobcode) == "parent_id")] <- "Group_code"

jobcode <- merge(x=jobcode[,c("ID", "Job_title", "Job_code", "Job_subgroup", "Subgroup_code", "Group_code")], 
                 y=coding2[,c("coding", "parent_id", "meaning")], 
                 by.x="Group_code", by.y="coding", all.x=TRUE)
colnames(jobcode)[which(names(jobcode) == "meaning")] <- "Job_group"
jobcode$Job_group <- factor(jobcode$Job_group)
colnames(jobcode)[which(names(jobcode) == "parent_id")] <- "Category_code"

jobcode <- merge(x=jobcode[,c("ID", "Job_title", "Job_code", "Job_subgroup", "Subgroup_code", "Job_group", "Group_code", "Category_code")], 
                 y=coding2[,c("coding", "parent_id", "meaning")], 
                 by.x="Category_code", by.y="coding", all.x=TRUE)
colnames(jobcode)[which(names(jobcode) == "meaning")] <- "Job_category"
jobcode$Job_category <- factor(jobcode$Job_category)
colnames(jobcode)[which(names(jobcode) == "parent_id")] <- "Top_level_code"

jobcode <- merge(x=jobcode[,c("ID", "Job_title", "Job_code", "Job_subgroup", "Subgroup_code", "Job_group", "Group_code", "Job_category", "Category_code", "Top_level_code")], 
                 y=coding2[,c("coding", "parent_id", "meaning")], 
                 by.x="Top_level_code", by.y="coding", all.x=TRUE)
colnames(jobcode)[which(names(jobcode) == "meaning")] <- "Top_level"
jobcode$Top_level <- factor(jobcode$Top_level)

jobcode <- jobcode[,c("ID", "Job_title", "Job_code", "Job_subgroup", "Subgroup_code", "Job_group", "Group_code", "Job_category", "Category_code", "Top_level", "Top_level_code")]
kable(table(jobcode$Top_level, useNA=c('ifany')), caption=paste0("Job category, top level only, n=", nrow(jobcode)))


# #-----------------------------------------------------------------------------------------------------------------------
# # For individuals who entered a free-text "other" job, combine the subsequent coding of that free-text field
# #-----------------------------------------------------------------------------------------------------------------------
# othercode <- merge(x=employment[,c("ID", "VeI_EmpJobCode2")][!is.na(employment$VeI_EmpJobCode2),],
#                  y=coding2[,c("coding", "parent_id", "meaning")],
#                  by.x="VeI_EmpJobCode2", by.y="coding", all.x=TRUE)
# colnames(othercode)[which(names(othercode) == "meaning")] <- "Job_subgroup"
# othercode$Job_title <- factor(othercode$Job_subgroup)
# colnames(othercode)[which(names(othercode) == "VeI_EmpJobCode2")] <- "Subgroup_code"
# colnames(othercode)[which(names(othercode) == "parent_id")] <- "Group_code"
# 
# othercode <- merge(x=othercode[,c("ID", "Job_subgroup", "Subgroup_code", "Group_code")],
#                  y=coding2[,c("coding", "parent_id", "meaning")],
#                  by.x="Group_code", by.y="coding", all.x=TRUE)
# colnames(othercode)[which(names(othercode) == "meaning")] <- "Job_Group"
# othercode$Job_subgroup <- factor(othercode$Job_Group)
# colnames(othercode)[which(names(othercode) == "parent_id")] <- "Category_code"
# 
# othercode <- merge(x=othercode[,c("ID", "Job_subgroup", "Subgroup_code", "Job_Group", "Group_code", "Category_code")],
#                  y=coding2[,c("coding", "parent_id", "meaning")],
#                  by.x="Category_code", by.y="coding", all.x=TRUE)
# colnames(othercode)[which(names(othercode) == "meaning")] <- "Job_category"
# othercode$Job_group <- factor(othercode$Job_category)
# colnames(othercode)[which(names(othercode) == "parent_id")] <- "Top_level_code"
# 
# othercode <- merge(x=othercode[,c("ID", "Job_subgroup", "Subgroup_code", "Job_group", "Group_code", "Job_category", "Category_code", "Top_level_code")],
#                  y=coding2[,c("coding", "parent_id", "meaning")],
#                  by.x="Top_level_code", by.y="coding", all.x=TRUE)
# colnames(othercode)[which(names(othercode) == "meaning")] <- "Top_level"
# othercode$Top_level <- factor(othercode$Top_level)
# othercode <- othercode[,c("ID", "Job_subgroup", "Subgroup_code", "Job_group", "Group_code", "Job_category", "Category_code", "Top_level", "Top_level_code")]
# kable(table(othercode$Top_level), caption="Job category, top level only")
# 
```

Upon further inspection, the 'job title' and corresponding 'job code' fields (22600 and 22601) that you requested from the Excel are from additional questions asked during online follow-up questionnaires (and the "job title" field doesn't seem to be available in the data showcase at the moment). The equivalent data from the baseline assessment is the job code obtained during the verbal interview (field 132). Since there are so many different codes available (348), tabulating it at that degree of granularity would be hard to interpret, I have therefore tabulated it at the top level of job category groupings.

Within the data, I have expressed the category levels as:
* Top level
  + Job category
    * Job group
      + Job subgroup
        * Job title

Notably, there are about 170,000 individuals who did not answer this question (NA). 

Some participants had a free-text job title entered (n~14,500) and something called Cascot <https://warwick.ac.uk/fac/soc/ier/software/cascot/> was used to code these. These "deduced" job codes are available from the "subgroup" level up, along with the Cascot confidence score, and if we feel that they are likely to add value I can incorporate them.

Re employment status, see the following note from UKB <http://biobank.ctsu.ox.ac.uk/showcase/field.cgi?id=20119>:

> Most participant jobs were coded by staff in the clinic when the participant was present, with the results presented in Field 132. However, for various reasons, staff were occasionally unable to find suitable codings and the job was recorded as a "Other job" accompanied by a free-text description.
> In some cases participants declared an occupation which was not actually classified as paid/self-employment and this information was used to correct the answer given in Field 6142.

Again, if we want to use the employment status in the analysis and feel that this "correction" adds value then I'll integrate the corrections (n=3,364).

### Household

```{r household, include=TRUE, echo=FALSE}
household <- readRDS(paste0(filepath, "HoH_base", ".rds"))

kable(table(household$HoH_AccomType.0), caption="Accomodation Type")

kable(table(household$HoH_OwnOrRent.0, useNA=c('ifany')), caption="Own or rent")

kable(table(household$HoH_PreTaxInc.0, useNA=c('ifany')), caption="Pre-tax average household income")

hist(household$HoH_ResLength.0, main="Length of time at current address", xlab="Time at address, years")

household$size <- ""
household$size[household$HoH_HouseholdSize.0 == -1] <- "Do not know"
household$size[household$HoH_HouseholdSize.0 == -3 | is.na(household$HoH_HouseholdSize.0)] <- "Prefer not to answer"
household$size[household$HoH_HouseholdSize.0 == 1] <- "1"
household$size[household$HoH_HouseholdSize.0 == 2] <- "2"
household$size[household$HoH_HouseholdSize.0 == 3] <- "3"
household$size[household$HoH_HouseholdSize.0 == 4] <- "4"
household$size[household$HoH_HouseholdSize.0 == 5] <- "5"
household$size[household$HoH_HouseholdSize.0 > 5 & household$HoH_HouseholdSize.0 <= 10] <- "6 to 10"
household$size[household$HoH_HouseholdSize.0 > 10 & household$HoH_HouseholdSize.0 <= 20] <- "11 to 20"
household$size[household$HoH_HouseholdSize.0 > 20] <- "More than 20"
household$size <- factor(household$size, levels=c("1", "2", "3", "4", "5", "6 to 10", "11 to 20", "More than 20", "Do not know", "Prefer not to answer"))
kable(table(household$size, useNA=c('ifany')), caption="Number of people in household")

```

Other available household variables include: Number of vehicles, relationship of others in household to participant, attendance/disability/mobility allowance.

## Lifestyle behaviour

Physical activity and diet are complex, pending discussion on which variables are of most interest. 

### Smoking
```{r smoking, include=TRUE, echo=FALSE}
smoking <- readRDS(paste0(filepath, "Smo_base", ".rds"))

# smoking$Smo_Status <- factor(smoking$Smo_Status,
#                                     levels=c("Current", "Previous", "Never", "Prefer not to answer"))
kable(table(smoking$Smo_Status, useNA=c('ifany')), caption="Smoking status")

# smoking$Smo_TobaccoCurr <- factor(smoking$Smo_TobaccoCurr,
#                                     levels=c("Yes, on most or all days", "Only occasionally", "No", "Prefer not to answer"))
kable(table(smoking$Smo_TobaccoCurr, useNA=c('ifany')), caption="Current tobacco use")

# smoking$Smo_TobaccoPast <- factor(smoking$Smo_TobaccoPast,
#                                     levels=c("Current", "Previous", "Never", "Prefer not to answer"))
kable(table(smoking$Smo_TobaccoPast, useNA=c('ifany')), caption="Past tobacco use")
```

### Alcohol
```{r alcohol, include=TRUE, echo=FALSE}
alcohol <- readRDS(paste0(filepath, "Alc_base", ".rds"))

kable(table(alcohol$Alc_Status, useNA=c('ifany')), caption="Alcohol status")
kable(table(alcohol$Alc_Freq, useNA=c('ifany')), caption="Alcohol frequency")
```

### Sleep
```{r sleep, include=TRUE, echo=FALSE}
sleep <- readRDS(paste0(filepath, "Sle_base", ".rds"))

sleep$dur <- ""
sleep$dur[sleep$Sle_Duration == -1] <- "Do not know"
sleep$dur[sleep$Sle_Duration == -3 | is.na(sleep$Sle_Duration)] <- "Prefer not to answer"
sleep$dur[sleep$Sle_Duration < 5] <- "Less than 5"
sleep$dur[sleep$Sle_Duration == 6] <- "6"
sleep$dur[sleep$Sle_Duration == 7] <- "7"
sleep$dur[sleep$Sle_Duration == 8] <- "8"
sleep$dur[sleep$Sle_Duration == 9] <- "9"
sleep$dur[sleep$Sle_Duration == 10] <- "10"
sleep$dur[sleep$Sle_Duration > 10 & sleep$Sle_Duration <= 15] <- "11 to 15"
sleep$dur[sleep$Sle_Duration > 15] <- "More than 15"
sleep$dur <- factor(sleep$dur, levels=c("Less than 5", "6", "7", "8", "9", "10", "11 to 15", "More than 15", "Do not know", "Prefer not to answer"))

kable(table(sleep$dur, useNA=c('ifany')), caption="Sleep duration, hours")
```

### Diet
```{r diet, include=TRUE, echo=FALSE}
diet <- readRDS(paste0(filepath, "Die_base", ".rds"))

kable(table(diet$Die_Salt, useNA=c('ifany')), caption="Salt added to food")

```

### Physical activity
```{r physicalactivity, include=TRUE, echo=FALSE}
physact <- readRDS(paste0(filepath, "PhA_base", ".rds"))


physact$TV <- ""
physact$TV[physact$PhA_TVTime == -10] <- "Less than 1 hour per day"
physact$TV[physact$PhA_TVTime == -1] <- "Do not know"
physact$TV[physact$PhA_TVTime == -3 | is.na(sleep$Sle_Duration)] <- "Prefer not to answer"
physact$TV[physact$PhA_TVTime == 1] <- "1"
physact$TV[physact$PhA_TVTime == 2] <- "2"
physact$TV[physact$PhA_TVTime == 3] <- "3"
physact$TV[physact$PhA_TVTime >= 4 & physact$Sle_Duration <= 6] <- "4 to 6"
physact$TV[physact$PhA_TVTime >= 7 & physact$Sle_Duration <= 12] <- "7 to 12"
physact$TV[physact$PhA_TVTime >= 13 & physact$Sle_Duration <= 18] <- "13 to 18"
physact$TV[physact$PhA_TVTime > 18] <- "More than 18"
physact$TV <- factor(physact$TV, levels=c("Less than 1 hour per day", "1", "2", "3", "4 to 6", "7 to 12", "13 to 18", "More than 18", "Do not know", "Prefer not to answer"))

kable(table(physact$TV, useNA=c('ifany')), caption="Time spent watching TV, hours/day")

act_dursplit <- function(df, colname, newcol) {
  df[[newcol]] <- ""
  df[[newcol]][df[[colname]] == -1] <- "Do not know"
  df[[newcol]][df[[colname]] == -3] <- "Prefer not to answer"
  df[[newcol]][df[[colname]] > 0 & df[[colname]] <= 15] <- "Less than 15 minutes"
  df[[newcol]][df[[colname]] > 15 & df[[colname]] <= 30] <- "15 to 30 minutes"
  df[[newcol]][df[[colname]] > 30 & df[[colname]] <= 60] <- "30 to 60 minutes"
  df[[newcol]][df[[colname]] > 60 & df[[colname]] <= 120] <- "1 to 2 hours"
  df[[newcol]][df[[colname]] > 120 & df[[colname]] <= 180] <- "2 to 3 hours"
  df[[newcol]][df[[colname]] > 180 & df[[colname]] <= 360] <- "3 to 6 hours"
  df[[newcol]][df[[colname]] > 360 & df[[colname]] <= 720] <- "6 to 12 hours"
  df[[newcol]][df[[colname]] > 720 & df[[colname]] <= 1080] <- "12 to 18 hours"
  df[[newcol]][df[[colname]] > 1080] <- "More than 18 hours"
  
  df[[newcol]] <- factor(df[[newcol]], levels=c("Less than 15 minutes", "15 to 30 minutes", "30 to 60 minutes", "1 to 2 hours", "2 to 3 hours", "3 to 6 hours", "6 to 12 hours", "12 to 18 hours", "More than 18 hours", "Do not know", "Prefer not to answer"))
  return(df)
}
physact <- act_dursplit(physact, "PhA_WalkDur", "WalkDur")
physact <- act_dursplit(physact, "PhA_ModActDur", "ModActDur")
physact <- act_dursplit(physact, "PhA_VigActDur", "VigActDur")

kable(table(physact$WalkDur, useNA=c('ifany')), caption="Duration of walking, minutes/day")
kable(table(physact$ModActDur, useNA=c('ifany')), caption="Duration of moderate physical activity, minutes/day")
kable(table(physact$VigActDur, useNA=c('ifany')), caption="Duration of vigorous physical activity, minutes/day")

```

The "duration of [walking/moderate/vigorous] physical activity" question was asked only to those who stated that they did more than 10 minutes of [walking/moderate/vigorous] activity *on at least 1 day per week in the previous 4 weeks*.

### Mental health
```{r mentalhealth, include=TRUE, echo=FALSE}
HES <- readRDS(paste0(filepath, "HES", ".rds"))

mentalcat <- HES[,c("ID", "HES_MentalCateg.m0", "HES_MentalCateg.m1")]
mentalcat <- reshape(mentalcat, varying=sort(colnames(mentalcat[,-1])), direction="long", idvar="ID", sep=".")
mentalcat <- mentalcat[,!(names(mentalcat) == "time")][!is.na(mentalcat$HES_MentalCateg),]
kable(table(mentalcat$HES_MentalCateg, useNA=c('ifany')), caption="Mental category")
```

From the online description of the "Mental Categories" field (Data Item 41217):

> This field is a summary of the distinct mental category codes a participant has had recorded in their hospital inpatient records. The mental categories are in accordance with the Mental Health Act 1983.

There aren't many mental-health specific questions at at baseline.
In the online follow-up (reduced sample size) there are the questions "Mental health problems ever diagnosed by a professional" ([Data Item 20544](https://biobank.ndph.ox.ac.uk/showcase/field.cgi?id=20544), n~50,000) and "Ever sought or received professional help for mental distress" ([Data Item 20499](https://biobank.ndph.ox.ac.uk/showcase/field.cgi?id=20499), n~150,000).

### Medical History
```{r HMH, include=TRUE, echo=FALSE}
hmh <- readRDS(paste0(filepath, "HMH_base", ".rds"))

kable(table(hmh$HMH_IllDisab, useNA=c('ifany')), caption="Long standing illness, disability or infirmity")
```






