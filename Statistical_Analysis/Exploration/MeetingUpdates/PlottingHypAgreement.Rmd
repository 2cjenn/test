---
title: "Graphical representation of hypertension agreement"
author: "Jennifer Collister"
date: "13/02/2020"
output: 
  word_document:
      reference_docx: "K:/TEU/TEU Guides/TEU_DocStyle_Rmd_2020.dotx"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(dplyr)
library(vcd)
library(knitr)
library(kableExtra)

source("K:/TEU/APOE on Dementia/Statistical Analysis/JCfunctions.R")
```

```{r loaddata, include=FALSE}
data <- readRDS(file="K:\\TEU\\APOE on Dementia\\Data Management\\R_Dataframes_TLA\\38358\\Organised\\apoe_excl.rds")
data <- data[data$age >= 50 & data$age < 70,]

# Create a couple of factor variables
data$selfrephyp <- data$prevHBP==TRUE | data$VIhyp==TRUE
data$control <- !(data$SBP>=140 | data$DBP>=90)

# Center age on the minimum
data$c_age <- data$age - 50

# Make the key dichotomous variables into factors to improve readability of outputs
data[["Self reported hypertension?"]] <- factor(as.numeric(data$selfrephyp), levels=c(0,1), labels=c("No", "Yes"))
data[["Measured hypertensive at baseline?"]] <- factor(as.numeric(data$measuredhyp), levels=c(0,1), labels=c("No", "Yes"))
data$selfrephyp <- factor(as.numeric(data$selfrephyp), levels=c(0,1), labels=c("Did not report hypertension", "Self-reported hypertensive"))
data$measuredhyp <- factor(as.numeric(data$measuredhyp), levels=c(0,1), labels=c("Not hypertensive at baseline", "Measured hypertensive at baseline"))

```

# Population

Here we consider the population we've been using for the APOE analysis - individuals from UKB aged [50, 70) of white ethnicity, with complete blood pressure and APOE data and no history of dementia.

# Variables

The self-reported hypertension variable is "Yes" if a patient reported a hypertension diagnosis in EITHER the touchscreen questionnaire OR the nurse-led verbal interview. It is "No" if they did not report a hypertension diagnosis in either.

The measured BP variable considers an indvidual to be hypertensive if the average of two BP measurements at baseline assessment was greater than or equal to 140/90.

# Tabulate self reported hypertension diagnosis against measured BP at baseline assessment.

```{r Table, include=TRUE, echo=FALSE}

tab <- table(data$selfrephyp, data$measuredhyp, useNA='ifany')
kable(propped(tab))

```

Since Venn diagrams are not normally drawn to scale, and the comparative size of the area outside the circles is not readily interpretable, a mosaic plot was considered as an alternative graphical representation of the relative sizes of each group.


# Mosaic plot of the above table

```{r Mosaic, include=TRUE, echo=FALSE}

tab <- structable(`Measured hypertensive at baseline?`~`Self reported hypertension?`, data=data)
mosaic(tab)

```




```{r bubbleplot, include=FALSE}

selfreport <- c("No", "No", "Yes", "Yes")
measured <- c("No", "Yes", "No", "Yes")
population <- c(199986, 120904, 38339, 83151)
bubble <- data.frame(selfreport, measured, population)

ggplot(bubble, aes(x=measured, y=selfreport, size=population)) + 
  geom_point(alpha=0.7) +
  scale_size_area(max_size=40, name="Number of individuals") +
  ggtitle("Hypertension agreement")

```

